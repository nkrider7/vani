"use strict";var D=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var Y=(r,e)=>{for(var t in e)D(r,t,{get:e[t],enumerable:!0})},O=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of B(e))!N.call(r,n)&&n!==t&&D(r,n,{get:()=>e[n],enumerable:!(i=$(e,n))||i.enumerable});return r};var A=r=>O(D({},"__esModule",{value:!0}),r);var q={};Y(q,{PredictionEngine:()=>I});module.exports=A(q);var S={lutealPhaseDays:14,irregularityStdThreshold:4,minIntervalsForConfidence:3};var c=require("date-fns");function R(r){return(0,c.parseISO)(r)}function L(r){return(0,c.format)(r,"yyyy-MM-dd")}function o(r,e){return L((0,c.addDays)(R(r),e))}function v(r,e){return(0,c.differenceInCalendarDays)(R(e),R(r))}function C(r){return r.length===0?0:r.reduce((e,t)=>e+t,0)/r.length}function P(r){let e=C(r),t=r.reduce((i,n)=>i+(n-e)**2,0)/(r.length||1);return Math.sqrt(t)}function l(r,e=0,t=1){return Math.max(e,Math.min(t,r))}function x(r){return r.length<2?{irregular:!1}:P(r)>5?{irregular:!0,message:"Your cycles vary more than usual."}:{irregular:!1}}function F(r){let e=[...r.periodStarts];if(e.length<1)throw new Error("need at least one period start");let t=[];for(let u=0;u+1<e.length;u++)t.push(v(e[u].date,e[u+1].date));let i=e[e.length-1].date;if(t.length===0)return{likely:o(i,28),confidence:.2,notes:["Not enough data for a reliable prediction, using a 28-day cycle as a fallback."]};let n=Math.round(C(t)),s=P(t),a=o(i,n),y=Math.min(3,Math.max(1,Math.round(s/2))),b=o(a,-y),h=o(a,y),g=l((t.length-1)/10,0,.8),M=l(1-s/10,0,1),k=l(g*.6+M*.4,0,1),d=[`Your average cycle length is ${n} days.`,`Based on ${t.length} cycles.`],f=x(t);return f.irregular&&d.push(f.message),s<2?d.push("Your cycles are very regular. Prediction reliability is high."):s<4?d.push("Recent cycles are stable. Prediction reliability is good."):d.push("Cycle variance is slightly higher, which may affect prediction accuracy."),{likely:a,window:{start:b,end:h},confidence:k,notes:d}}function U(r){let e=[];for(let t=0;t+1<r.length;t++)e.push(v(r[t].date,r[t+1].date));return e}function T(r){let e=[...r.periodStarts];if(e.length<1)throw new Error("need at least one period start");let t=U(e),i=e[e.length-1].date;if(t.length===0)return{likely:o(i,28),confidence:.2,notes:["Not enough data for a reliable prediction, using a 28-day cycle as a fallback."]};let n=t.length,s=t.map((m,w)=>Math.pow(2,w+1));s.reverse();let a=s.reduce((m,w)=>m+w,0),y=t.reduce((m,w,W)=>m+w*(s[W]/a),0),b=Math.round(y),h=o(i,b),g=P(t),M=l((n-1)/10,0,.8),k=l(1-g/10,0,1),d=l(M*.5+k*.5,0,1),f=Math.min(3,Math.max(1,Math.round(g/2))),u=o(h,-f),E=o(h,f),p=[`Predicted cycle length is ${b} days (based on a weighted average of recent cycles).`],H=x(t);return H.irregular&&p.push(H.message),g<2?p.push("Your cycles are very regular. Prediction reliability is high."):g<4?p.push("Recent cycles are stable. Prediction reliability is good."):p.push("Cycle variance is slightly higher, which may affect prediction accuracy."),{likely:h,window:{start:u,end:E},confidence:d,notes:p}}var I=class{config;strategies=new Map;constructor(e){this.config={...S,...e},this.registerStrategy("calendar",t=>F(t)),this.registerStrategy("wma",t=>T(t))}registerStrategy(e,t){this.strategies.set(e,t)}chooseStrategy(e){let t=e||this.config.strategy||"wma",i=this.strategies.get(t);if(!i)throw new Error(`Strategy '${t}' not found`);return i}predictNextPeriod(e){return this.chooseStrategy(this.config.strategy)(e,this.config)}predictOvulation(e){let t=this.predictNextPeriod(e),i=this.config.lutealPhaseDays??S.lutealPhaseDays,n=o(t.likely,-i),s=[...t.notes||[],`estimated ovulation = ${n}`];return{likely:n,confidence:t.confidence,notes:s}}predictFertileWindow(e){let t=this.predictOvulation(e),i=o(t.likely,-5),n=o(t.likely,1);return{start:i,peak:t.likely,end:n,confidence:t.confidence,notes:t.notes}}predictPregnancy(e){let t=o(e,280),n=new Date().getTime()-new Date(e).getTime(),s=Math.round(n/(1e3*60*60*24)),a=Math.max(0,Math.floor(s/7)+1),y=Math.min(3,Math.ceil(a/13));return{dueDate:t,currentWeek:a,currentTrimester:y}}analyze(e){let t={};for(let[i,n]of this.strategies.entries())try{t[i]=n(e,this.config)}catch{}return t}};0&&(module.exports={PredictionEngine});
//# sourceMappingURL=index.cjs.map