"use strict";var v=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var B=(n,e)=>{for(var t in e)v(n,t,{get:e[t],enumerable:!0})},O=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of E(e))!W.call(n,r)&&r!==t&&v(n,r,{get:()=>e[r],enumerable:!(o=T(e,r))||o.enumerable});return n};var A=n=>O(v({},"__esModule",{value:!0}),n);var U={};B(U,{PredictionEngine:()=>P});module.exports=A(U);var D={lutealPhaseDays:14,irregularityStdThreshold:4,minIntervalsForConfidence:3};var d=require("date-fns");function S(n){return(0,d.parseISO)(n)}function L(n){return(0,d.format)(n,"yyyy-MM-dd")}function i(n,e){return L((0,d.addDays)(S(n),e))}function m(n,e){return(0,d.differenceInCalendarDays)(S(e),S(n))}function b(n){return n.length===0?0:n.reduce((e,t)=>e+t,0)/n.length}function w(n){let e=b(n),t=n.reduce((o,r)=>o+(r-e)**2,0)/(n.length||1);return Math.sqrt(t)}function l(n,e=0,t=1){return Math.max(e,Math.min(t,n))}function k(n){let e=[...n.periodStarts];if(e.length<1)throw new Error("need at least one period start");let t=[];for(let c=0;c+1<e.length;c++)t.push(m(e[c].date,e[c+1].date));let o=e[e.length-1].date;if(t.length===0)return{likely:i(o,28),confidence:.2,notes:["not enough data, used fallback 28d"]};let r=Math.round(b(t)),s=w(t),a=i(o,r),u=Math.min(3,Math.max(1,Math.round(s/2))),h=i(a,-u),g=i(a,u),y=l((t.length-1)/10,0,.8),x=l(1-s/10,0,1),I=l(y*.6+x*.4,0,1),M=[`avg interval ${r}d`,`std ${s.toFixed(2)}d`,`samples ${t.length}`];return{likely:a,window:{start:h,end:g},confidence:I,notes:M}}function N(n){let e=[];for(let t=0;t+1<n.length;t++)e.push(m(n[t].date,n[t+1].date));return e}function F(n){let e=[...n.periodStarts];if(e.length<1)throw new Error("need at least one period start");let t=N(e),o=e[e.length-1].date;if(t.length===0)return{likely:i(o,28),confidence:.2,notes:["not enough data, fallback 28d"]};let r=t.length,s=t.map((f,p)=>Math.pow(2,p+1));s.reverse();let a=s.reduce((f,p)=>f+p,0),u=t.reduce((f,p,C)=>f+p*(s[C]/a),0),h=Math.round(u),g=i(o,h),y=w(t),x=l((r-1)/10,0,.8),I=l(1-y/10,0,1),M=l(x*.5+I*.5,0,1),c=Math.min(3,Math.max(1,Math.round(y/2))),R=i(g,-c),H=i(g,c),$=[`wma ${u.toFixed(2)}d`,`pred interval ${h}d`,`std ${y.toFixed(2)}d`];return{likely:g,window:{start:R,end:H},confidence:M,notes:$}}var P=class{config;strategies=new Map;constructor(e){this.config={...D,...e},this.registerStrategy("calendar",t=>k(t)),this.registerStrategy("wma",t=>F(t))}registerStrategy(e,t){this.strategies.set(e,t)}chooseStrategy(e){let t=e||this.config.strategy||"wma",o=this.strategies.get(t);if(!o)throw new Error(`Strategy '${t}' not found`);return o}predictNextPeriod(e){return this.chooseStrategy(this.config.strategy)(e,this.config)}predictOvulation(e){let t=this.predictNextPeriod(e),o=this.config.lutealPhaseDays??D.lutealPhaseDays,r=i(t.likely,-o),s=[...t.notes||[],`estimated ovulation = ${r}`];return{likely:r,confidence:t.confidence,notes:s}}predictFertileWindow(e){let t=this.predictOvulation(e),o=i(t.likely,-5),r=i(t.likely,1);return{start:o,peak:t.likely,end:r,confidence:t.confidence,notes:t.notes}}predictPregnancy(e){let t=i(e,280),r=new Date().getTime()-new Date(e).getTime(),s=Math.round(r/(1e3*60*60*24)),a=Math.max(0,Math.floor(s/7)+1),u=Math.min(3,Math.ceil(a/13));return{dueDate:t,currentWeek:a,currentTrimester:u}}analyze(e){let t={};for(let[o,r]of this.strategies.entries())try{t[o]=r(e,this.config)}catch{}return t}};0&&(module.exports={PredictionEngine});
//# sourceMappingURL=index.cjs.map